<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard Personnels Vie Scolaire – Collèges 44 (académie de Nantes)</title>
  <style>
    :root {
      color-scheme: light dark;
      --bg: #f6f8fa;
      --card: #ffffff;
      --text: #222;
      --muted: #555;
      --accent: #2563eb;
      --accent-2: #16a34a;
      --border: #dce3ec;
      --shadow: 0 2px 8px rgba(0,0,0,0.08);
      font-family: system-ui, -apple-system, Segoe UI, sans-serif;
    }
    body {
      margin: 0;
      padding: 32px;
      background: var(--bg);
      color: var(--text);
    }
    h1 { margin: 0 0 8px; font-size: 24px; }
    h2 { margin: 24px 0 12px; }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
      margin: 16px 0 24px;
    }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 14px 16px;
      box-shadow: var(--shadow);
    }
    .muted { color: var(--muted); font-size: 13px; }
    .value { font-size: 22px; font-weight: 700; }
    .bar-chart {
      display: grid;
      gap: 8px;
    }
    .bar {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .bar-label { width: 220px; font-size: 13px; }
    .bar-track {
      flex: 1;
      background: #e5e7eb;
      border-radius: 8px;
      overflow: hidden;
      height: 14px;
    }
    .bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    th, td {
      padding: 8px;
      border-bottom: 1px solid var(--border);
      text-align: left;
    }
    th {
      position: sticky;
      top: 0;
      background: var(--card);
      z-index: 1;
    }
    tbody tr:hover { background: rgba(37,99,235,0.08); }
    .tag { padding: 2px 8px; border-radius: 999px; font-size: 12px; }
    .tag.public { background: rgba(37,99,235,0.12); color: var(--accent); }
    .tag.prive { background: rgba(16,185,129,0.12); color: #0f766e; }
    .container { max-width: 1300px; margin: 0 auto; }
    .top-bar { display: flex; justify-content: space-between; align-items: baseline; gap: 12px; flex-wrap: wrap; }
    .footnote { font-size: 12px; color: var(--muted); margin-top: 12px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="top-bar">
      <div>
        <h1>Dashboard – Personnels de vie scolaire · Collèges de Loire-Atlantique (44)</h1>
        <div class="muted">Académie de NANTES · Indicateurs personnels 2024 · Effectifs élèves (dernière année dispo trouvée)</div>
      </div>
      <div class="muted">Sources : fr-en-indicateurs_personnels_etablissements2d.csv & fr-en-effectifs-second-degre.csv</div>
    </div>

    <div id="cards" class="grid"></div>

    <h2>Top 15 collèges publics par ETP (personnels vie scolaire)</h2>
    <div id="chart" class="card bar-chart"></div>

    <h2>Top 15 collèges publics par ratio élèves / ETP</h2>
    <div id="chart-ratio" class="card bar-chart"></div>

    <h2>Vue détaillée</h2>
    <div class="card" style="padding:12px; overflow:auto; max-height:650px;">
      <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
        <input id="filter-text" type="search" placeholder="Filtrer par collège ou commune" style="flex:1; padding:8px; border:1px solid var(--border); border-radius:8px;" />
      </div>
      <table>
        <thead>
          <tr>
            <th data-sort="nom" style="cursor:pointer;">Collège</th>
            <th data-sort="commune" style="cursor:pointer;">Commune</th>
            <th data-sort="aed_etp" style="cursor:pointer;">ETP</th>
            <th data-sort="eleves" style="cursor:pointer;">Élèves</th>
            <th data-sort="ratio" style="cursor:pointer;">Ratio élèves / ETP</th>
          </tr>
        </thead>
        <tbody id="table-body"></tbody>
      </table>
    </div>
    <div class="footnote">
      Note : seuls les établissements publics sont inclus. Les ETP « personnels de vie scolaire » comprennent principalement les AED (surveillants, assistants pédagogiques, assistants de prévention et de sécurité, assistants en préprofessionnalisation, etc.) et peuvent inclure les CPE ou d’autres personnels éducatifs selon la déclaration de l’établissement.
    </div>
  </div>

  <script type="application/json" id="data-json">
{
  "records": [
    {
      "uai": "0440147W",
      "nom": "College Rene Guy Cadou",
      "aed_etp": 8.92,
      "eleves": 969,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "ANCENIS CEDEX"
    },
    {
      "uai": "0440311Z",
      "nom": "College Ernest Renan",
      "aed_etp": 8.2,
      "eleves": 492,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "ST HERBLAIN"
    },
    {
      "uai": "0442052S",
      "nom": "College Pierre Abelard",
      "aed_etp": 6.93,
      "eleves": 626,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "VALLET"
    },
    {
      "uai": "0440289A",
      "nom": "College Jean Mounes",
      "aed_etp": 7.9,
      "eleves": 805,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "PORNIC"
    },
    {
      "uai": "0442835T",
      "nom": "College Simone Veil",
      "aed_etp": 5.9,
      "eleves": 548,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "NANTES"
    },
    {
      "uai": "0442011X",
      "nom": "College La Coutanciere",
      "aed_etp": 5.4,
      "eleves": 504,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "LA CHAPELLE SUR ERDRE CEDE"
    },
    {
      "uai": "0440350S",
      "nom": "College Albert Vincon",
      "aed_etp": 5.9,
      "eleves": 517,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "ST NAZAIRE"
    },
    {
      "uai": "0440049P",
      "nom": "College Aristide Briand",
      "aed_etp": 5.0,
      "eleves": 531,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "NANTES CEDEX 2"
    },
    {
      "uai": "0440028S",
      "nom": "College La Coliniere",
      "aed_etp": 5.3,
      "eleves": 556,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "NANTES CEDEX 3"
    },
    {
      "uai": "0440015C",
      "nom": "College Jacques Prevert",
      "aed_etp": 4.6,
      "eleves": 420,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "HERBIGNAC"
    },
    {
      "uai": "0442921L",
      "nom": "College Camille Lepage",
      "aed_etp": 4.9,
      "eleves": null,
      "secteur": "Public",
      "effectifs_annee": null,
      "commune": null
    },
    {
      "uai": "0442368K",
      "nom": "College Du Pays Blanc",
      "aed_etp": 4.2,
      "eleves": 372,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "GUERANDE"
    },
    {
      "uai": "0440010X",
      "nom": "College Paul Langevin",
      "aed_etp": 7.55,
      "eleves": 757,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "COUERON"
    },
    {
      "uai": "0442029S",
      "nom": "College Gerard Philipe",
      "aed_etp": 8.4,
      "eleves": 791,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "CARQUEFOU CEDEX"
    },
    {
      "uai": "0440314C",
      "nom": "College Jean Moulin",
      "aed_etp": 8.7,
      "eleves": 677,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "ST NAZAIRE"
    },
    {
      "uai": "0441545R",
      "nom": "College La Noe Lambert",
      "aed_etp": 6.8,
      "eleves": 613,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "NANTES"
    },
    {
      "uai": "0443020U",
      "nom": "College De Nantes Centre",
      "aed_etp": 8.0,
      "eleves": null,
      "secteur": "Public",
      "effectifs_annee": null,
      "commune": null
    },
    {
      "uai": "0441654J",
      "nom": "College Isabelle Autissier",
      "aed_etp": 7.0,
      "eleves": 688,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "NORT SUR ERDRE"
    },
    {
      "uai": "0442759K",
      "nom": "College Anita Conti",
      "aed_etp": 6.5,
      "eleves": 642,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "ST NAZAIRE"
    },
    {
      "uai": "0442625P",
      "nom": "College Olympe De Gouges Ste Pazanne",
      "aed_etp": 7.8,
      "eleves": 741,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "STE PAZANNE"
    },
    {
      "uai": "0442728B",
      "nom": "College Marcelle Baron",
      "aed_etp": 6.2,
      "eleves": 638,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "HERIC"
    },
    {
      "uai": "0440016D",
      "nom": "College Anne De Bretagne",
      "aed_etp": 6.4,
      "eleves": 640,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "ST HERBLAIN"
    },
    {
      "uai": "0441547T",
      "nom": "College Le Grand Beauregard",
      "aed_etp": 5.1,
      "eleves": 554,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "LA CHAPELLE SUR ERDRE CEDE"
    },
    {
      "uai": "0440292D",
      "nom": "College Jean Mermoz",
      "aed_etp": 5.0,
      "eleves": 580,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "NOZAY"
    },
    {
      "uai": "0442806L",
      "nom": "College Mona Ozouf",
      "aed_etp": 6.3,
      "eleves": 508,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "SAVENAY"
    },
    {
      "uai": "0440080Y",
      "nom": "College Jean Monnet",
      "aed_etp": 5.2,
      "eleves": 494,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "VERTOU"
    },
    {
      "uai": "0440025N",
      "nom": "College Hector Berlioz",
      "aed_etp": 4.9,
      "eleves": 485,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "NANTES"
    },
    {
      "uai": "0440285W",
      "nom": "College Gaston Serpette",
      "aed_etp": 5.1,
      "eleves": 532,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "NANTES"
    },
    {
      "uai": "0441822S",
      "nom": "College Grand Air",
      "aed_etp": 5.0,
      "eleves": 478,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "LA BAULE CEDEX"
    },
    {
      "uai": "0440286X",
      "nom": "College Claude Debussy",
      "aed_etp": 6.5,
      "eleves": 256,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "NANTES"
    },
    {
      "uai": "0441862K",
      "nom": "College Louise Michel",
      "aed_etp": 5.1,
      "eleves": 393,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "PAIMBOEUF"
    },
    {
      "uai": "0440539X",
      "nom": "College Rene Guy Cadou",
      "aed_etp": 5.11,
      "eleves": 363,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "MONTOIR DE BRETAGNE"
    },
    {
      "uai": "0442807M",
      "nom": "College Frida Kahlo",
      "aed_etp": 10.3,
      "eleves": 480,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "PONTCHATEAU"
    },
    {
      "uai": "0440284V",
      "nom": "College Stendhal",
      "aed_etp": 10.2,
      "eleves": 456,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "NANTES CEDEX 3"
    },
    {
      "uai": "0440348P",
      "nom": "College La Ville Aux Roses",
      "aed_etp": 8.3,
      "eleves": 648,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "CHATEAUBRIANT CEDEX"
    },
    {
      "uai": "0441616T",
      "nom": "College Julien Lambot",
      "aed_etp": 8.48,
      "eleves": 541,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "TRIGNAC"
    },
    {
      "uai": "0440055W",
      "nom": "College Jean Rostand",
      "aed_etp": 7.1,
      "eleves": 633,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "ORVAULT CEDEX"
    },
    {
      "uai": "0442023K",
      "nom": "College Paul Gauguin",
      "aed_etp": 6.1,
      "eleves": 537,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "CORDEMAIS"
    },
    {
      "uai": "0441610L",
      "nom": "College Gutenberg",
      "aed_etp": 5.6,
      "eleves": 471,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "ST HERBLAIN"
    },
    {
      "uai": "0442417N",
      "nom": "College Les Sables D Or",
      "aed_etp": 3.8,
      "eleves": 584,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "THOUARE SUR LOIRE"
    },
    {
      "uai": "0440293E",
      "nom": "College Robert Schuman",
      "aed_etp": 6.0,
      "eleves": 512,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "CHATEAUBRIANT CEDEX"
    },
    {
      "uai": "0442781J",
      "nom": "College Rosa Parks",
      "aed_etp": 5.9,
      "eleves": 620,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "CLISSON CEDEX"
    },
    {
      "uai": "0441658N",
      "nom": "College Pierre Et Marie Curie",
      "aed_etp": 5.2,
      "eleves": 455,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "LE PELLERIN"
    },
    {
      "uai": "0440018F",
      "nom": "College Raymond Queneau",
      "aed_etp": 5.76,
      "eleves": 439,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "MACHECOUL ST MEME"
    },
    {
      "uai": "0440347N",
      "nom": "College Saint Exupery",
      "aed_etp": 5.0,
      "eleves": 454,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "LA MONTAGNE"
    },
    {
      "uai": "0440013A",
      "nom": "College Bellevue",
      "aed_etp": 5.4,
      "eleves": 434,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "GUEMENE PENFAO"
    },
    {
      "uai": "0440291C",
      "nom": "College Iles De Loire",
      "aed_etp": 4.7,
      "eleves": 426,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "ST SEBASTIEN SUR LOIRE"
    },
    {
      "uai": "0441917V",
      "nom": "College La Fontaine",
      "aed_etp": 5.1,
      "eleves": 354,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "MISSILLAC"
    },
    {
      "uai": "0441655K",
      "nom": "College Louis Pasteur",
      "aed_etp": 5.4,
      "eleves": 350,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "VALLONS DE L ERDRE"
    },
    {
      "uai": "0441612N",
      "nom": "College Pierre De Coubertin",
      "aed_etp": 3.8,
      "eleves": 312,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "LEGE"
    },
    {
      "uai": "0441548U",
      "nom": "College Rene Bernier",
      "aed_etp": 9.0,
      "eleves": 678,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "ST SEBASTIEN SUR LOIRE"
    },
    {
      "uai": "0441724K",
      "nom": "College La Reinetiere",
      "aed_etp": 6.73,
      "eleves": 584,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "STE LUCE SUR LOIRE"
    },
    {
      "uai": "0440065G",
      "nom": "College Petite Lande",
      "aed_etp": 7.0,
      "eleves": 666,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "REZE CEDEX"
    },
    {
      "uai": "0441657M",
      "nom": "College Antoine De Saint Exupery",
      "aed_etp": 6.0,
      "eleves": 551,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "SAVENAY"
    },
    {
      "uai": "0441686U",
      "nom": "College Auguste Mailloux",
      "aed_etp": 6.0,
      "eleves": 642,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "LE LOROUX BOTTEREAU"
    },
    {
      "uai": "0442542Z",
      "nom": "College Andree Chedid",
      "aed_etp": 6.3,
      "eleves": 636,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "AIGREFEUILLE SUR MAINE"
    },
    {
      "uai": "0440066H",
      "nom": "College Helene Et Rene Guy Cadou",
      "aed_etp": 7.17,
      "eleves": 603,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "ST BREVIN LES PINS"
    },
    {
      "uai": "0442277L",
      "nom": "College De Goulaine",
      "aed_etp": 6.0,
      "eleves": 592,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "BASSE GOULAINE"
    },
    {
      "uai": "0441859G",
      "nom": "College Eric Tabarly",
      "aed_etp": 5.0,
      "eleves": 534,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "LA BAULE"
    },
    {
      "uai": "0442595G",
      "nom": "College Lucie Aubrac",
      "aed_etp": 5.3,
      "eleves": 478,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "VERTOU CEDEX"
    },
    {
      "uai": "0441728P",
      "nom": "College Rene Char",
      "aed_etp": 5.0,
      "eleves": 287,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "ST JOACHIM"
    },
    {
      "uai": "0440061C",
      "nom": "College Jules Verne",
      "aed_etp": 3.5,
      "eleves": 178,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "LE POULIGUEN"
    },
    {
      "uai": "0440023L",
      "nom": "College Chantenay",
      "aed_etp": 8.7,
      "eleves": 786,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "NANTES CEDEX 4"
    },
    {
      "uai": "0440316E",
      "nom": "College Marie Marvingt",
      "aed_etp": 7.1,
      "eleves": 747,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "BOUGUENAIS"
    },
    {
      "uai": "0440045K",
      "nom": "College Victor Hugo",
      "aed_etp": 8.5,
      "eleves": 778,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "NANTES CEDEX 1"
    },
    {
      "uai": "0441613P",
      "nom": "College Pierre Norange",
      "aed_etp": 6.8,
      "eleves": 346,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "ST NAZAIRE"
    },
    {
      "uai": "0440308W",
      "nom": "College Alice Milliat",
      "aed_etp": 6.55,
      "eleves": 744,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "BLAIN"
    },
    {
      "uai": "0442691L",
      "nom": "College Agnes Varda",
      "aed_etp": 8.0,
      "eleves": 734,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "LIGNE"
    },
    {
      "uai": "0441858F",
      "nom": "College Bellestre",
      "aed_etp": 8.75,
      "eleves": 743,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "BOUAYE"
    },
    {
      "uai": "0442418P",
      "nom": "College Le Haut Gesvres",
      "aed_etp": 6.2,
      "eleves": 544,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "TREILLIERES"
    },
    {
      "uai": "0440008V",
      "nom": "College Cacault",
      "aed_etp": 6.9,
      "eleves": 677,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "CLISSON CEDEX"
    },
    {
      "uai": "0440534S",
      "nom": "College Salvador Allende",
      "aed_etp": 6.0,
      "eleves": 528,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "REZE"
    },
    {
      "uai": "0440538W",
      "nom": "College Jacques Brel",
      "aed_etp": 5.8,
      "eleves": 549,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "GUERANDE"
    },
    {
      "uai": "0440536U",
      "nom": "College Sophie Germain",
      "aed_etp": 7.3,
      "eleves": 312,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "NANTES"
    },
    {
      "uai": "0441608J",
      "nom": "College La Durantiere",
      "aed_etp": 6.0,
      "eleves": 370,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "NANTES"
    },
    {
      "uai": "0440283U",
      "nom": "College Libertaire Rutigliano",
      "aed_etp": 5.6,
      "eleves": 425,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "NANTES CEDEX 3"
    },
    {
      "uai": "0440064F",
      "nom": "College Pont Rousseau",
      "aed_etp": 5.9,
      "eleves": 606,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "REZE CEDEX"
    },
    {
      "uai": "0442782K",
      "nom": "College Julie Victoire Daubie",
      "aed_etp": 5.43,
      "eleves": 473,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "ST PHILBERT DE GRAND LIEU"
    },
    {
      "uai": "0440287Y",
      "nom": "College Le Herault",
      "aed_etp": 5.6,
      "eleves": 423,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "ST HERBLAIN"
    },
    {
      "uai": "0442186M",
      "nom": "College Condorcet",
      "aed_etp": 4.2,
      "eleves": 344,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "ST PHILBERT DE GRAND LIEU"
    },
    {
      "uai": "0441727N",
      "nom": "College Arthur Rimbaud",
      "aed_etp": 5.6,
      "eleves": 353,
      "secteur": "Public",
      "effectifs_annee": "2019-2020",
      "commune": "DONGES"
    },
    {
      "uai": "0443021V",
      "nom": "College De Chaumes En Retz",
      "aed_etp": 3.8,
      "eleves": null,
      "secteur": "Public",
      "effectifs_annee": null,
      "commune": null
    }
  ],
  "summary": {
    "nb_colleges": 82,
    "aed_total": 513.68,
    "aed_moyen": 6.26,
    "aed_min": 3.5,
    "aed_max": 10.3,
    "eleves_total": 42787
  }
}
  </script>

  <script>
    const payload = JSON.parse(document.getElementById('data-json').textContent);
    const records = payload.records;
    const summary = payload.summary;

    const formatNumber = (n) => n === null || n === undefined ? 'n.d.' : new Intl.NumberFormat('fr-FR').format(n);
    const formatFloat = (n) => n === null || n === undefined ? 'n.d.' : new Intl.NumberFormat('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(n);

    const ratioElevesParAed = summary.aed_total && summary.eleves_total
      ? summary.eleves_total / summary.aed_total
      : null;

    const cards = [
      { label: 'Collèges', value: summary.nb_colleges },
      { label: 'Total ETP', value: formatFloat(summary.aed_total) },
      { label: 'ETP moyen', value: formatFloat(summary.aed_moyen) },
      { label: 'Min / Max ETP', value: `${formatFloat(summary.aed_min)} / ${formatFloat(summary.aed_max)}` },
      { label: 'Élèves (total)', value: formatNumber(summary.eleves_total) },
      { label: 'Élèves par ETP', value: ratioElevesParAed ? formatFloat(ratioElevesParAed) : 'n.d.' }
    ];

    const cardsRoot = document.getElementById('cards');
    cardsRoot.innerHTML = cards.map(c => `
      <div class="card">
        <div class="muted">${c.label}</div>
        <div class="value">${c.value}</div>
      </div>
    `).join('');

    const topChartData = records
      .filter(r => typeof r.aed_etp === 'number')
      .sort((a, b) => b.aed_etp - a.aed_etp)
      .slice(0, 15);

    const maxAed = Math.max(...topChartData.map(r => r.aed_etp));
    const chartRoot = document.getElementById('chart');
    chartRoot.innerHTML = topChartData.map(r => `
      <div class="bar">
        <div class="bar-label">${r.nom}</div>
        <div class="bar-track">
          <div class="bar-fill" style="width:${(r.aed_etp / maxAed) * 100}%"></div>
        </div>
        <div class="muted" style="width:80px; text-align:right;">${formatFloat(r.aed_etp)} ETP</div>
      </div>
    `).join('');

    const ratioData = records
      .filter(r => typeof r.aed_etp === 'number' && typeof r.eleves === 'number' && r.aed_etp > 0)
      .map(r => ({ nom: r.nom, aed_etp: r.aed_etp, eleves: r.eleves, ratio: r.eleves / r.aed_etp }))
      .sort((a, b) => b.ratio - a.ratio)
      .slice(0, 15);

    const maxRatio = Math.max(...ratioData.map(r => r.ratio));
    const chartRatioRoot = document.getElementById('chart-ratio');
    chartRatioRoot.innerHTML = ratioData.map(r => `
      <div class="bar">
        <div class="bar-label">${r.nom}</div>
        <div class="bar-track">
          <div class="bar-fill" style="width:${(r.ratio / maxRatio) * 100}%"></div>
        </div>
        <div class="muted" style="width:90px; text-align:right;">${formatFloat(r.ratio)} élèves/ETP</div>
      </div>
    `).join('');

    const tbody = document.getElementById('table-body');
    const filterInput = document.getElementById('filter-text');
    const headers = Array.from(document.querySelectorAll('th[data-sort]'));

    let sortKey = 'aed_etp';
    let sortDir = 'desc';

    const baseRows = records.map(r => ({ 
      ...r,
      ratio: (typeof r.eleves === 'number' && typeof r.aed_etp === 'number' && r.aed_etp > 0)
        ? r.eleves / r.aed_etp
        : null,
    }));

    const applySort = (rows) => {
      const dir = sortDir === 'asc' ? 1 : -1;
      return rows.slice().sort((a, b) => {
        const av = a[sortKey];
        const bv = b[sortKey];
        if (av === null || av === undefined) return 1;
        if (bv === null || bv === undefined) return -1;
        if (av < bv) return -1 * dir;
        if (av > bv) return 1 * dir;
        return 0;
      });
    };

    const applyFilter = () => {
      const q = (filterInput.value || '').toLowerCase();
      return baseRows.filter(r => {
        if (!q) return true;
        return (r.nom || '').toLowerCase().includes(q) || (r.commune || '').toLowerCase().includes(q);
      });
    };

    const renderTable = () => {
      const filtered = applyFilter();
      const sorted = applySort(filtered);
      tbody.innerHTML = sorted.map(r => `
        <tr>
          <td>${r.nom}</td>
          <td>${r.commune || 'n.d.'}</td>
          <td>${formatFloat(r.aed_etp)} (2024)</td>
          <td>${formatNumber(r.eleves)} (${r.effectifs_annee || 'n.d.'})</td>
          <td>${formatFloat(r.ratio)}</td>
        </tr>
      `).join('');
    };

    headers.forEach(h => {
      h.addEventListener('click', () => {
        const key = h.getAttribute('data-sort');
        if (sortKey === key) {
          sortDir = sortDir === 'asc' ? 'desc' : 'asc';
        } else {
          sortKey = key;
          sortDir = key === 'nom' || key === 'commune' ? 'asc' : 'desc';
        }
        renderTable();
      });
    });

    filterInput.addEventListener('input', renderTable);
    renderTable();
  </script>
</body>
</html>
